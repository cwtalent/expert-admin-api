<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.expert.admin.mapper.ProjectMapper">
    
    <select id="findByProjectTypeId" resultType="com.expert.admin.entity.Project">
        SELECT * FROM projects 
        WHERE project_type_id = #{projectTypeId}
        ORDER BY COALESCE(sort_order, 0) ASC, id ASC
    </select>
    
    <select id="findByProjectTypeIdAndStatus" resultType="com.expert.admin.entity.Project">
        SELECT * FROM projects 
        WHERE project_type_id = #{projectTypeId} AND status = #{status}
        ORDER BY COALESCE(sort_order, 0) ASC, id ASC
    </select>
    
    <select id="searchProjects" resultType="com.expert.admin.entity.Project">
        SELECT p.*
        FROM projects p
        LEFT JOIN project_types pt ON p.project_type_id = pt.id
        <where>
            <if test="projectTypeId != null">
                AND p.project_type_id = #{projectTypeId}
            </if>
            <if test="projectName != null and projectName != ''">
                AND p.project_name LIKE CONCAT('%', #{projectName}, '%')
            </if>
            <if test="applicantName != null and applicantName != ''">
                AND p.applicant_name LIKE CONCAT('%', #{applicantName}, '%')
            </if>
            <if test="applicantDepartment != null and applicantDepartment != ''">
                AND p.applicant_department LIKE CONCAT('%', #{applicantDepartment}, '%')
            </if>
            <if test="status != null and status != ''">
                AND p.status = #{status}
            </if>
        </where>
        ORDER BY COALESCE(pt.sort_order, 0) ASC, COALESCE(p.sort_order, 0) ASC, p.id ASC
    </select>
    
</mapper>
